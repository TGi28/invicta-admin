import{j as g,V as ue,y as F,o as n,f as r,w as l,k as d,B as y,u as e,t as k,d as A,ao as me,D as R,bb as _e,F as j,p as H,a7 as pe,a8 as fe,G as J,H as K,a2 as ge,h as i,g as $,a4 as ve,a3 as he,S as ye,L as be,bc as we,bd as ke,r as $e,e as q,l as P,v as G,b2 as xe,ac as Se,a1 as Ie,aV as De,s as Ce,R as Ae}from"./vendor-DpzuCX-L.js";/* empty css                */import{u as Be,g as Fe,h as Ee,i as Re,e as Ue,b as Te}from"./dropdown-menu-BywocuEX.js";import{u as ze,_ as Q}from"./FormBase-ChJL8YBd.js";import{_ as Le}from"./Loading-BgLNKlre.js";/* empty css             */import{b as Pe,c as je}from"./main-DjFvluOL.js";const Ve={key:1},Me={__name:"ActionsModal",props:{actionsUrl:String},emits:["close"],setup(m,{emit:I}){const _=m,o=g(!1);let t=ue({name:"Action",class:"",blueprint:null,dangerous:!1,redirect:!1});g(0);const b=g(),f=g([]),u=g(!1),v=F(()=>({class:t.class,selected:f.value})),w=F(()=>t.dangerous?"danger":"primary"),x=F(()=>t.action_button??"Run Action");Invicta.on("show-action-modal",p=>{console.log("opening the action modal",p);let a=p.selected[0];f.value=p.selected||[],t=p.action,u.value=p.action.blueprint!==null,b.value=`action.${t.class}.${a??t.type}`,o.value=!0}),F(()=>({blueprint:t.blueprint}));const D=()=>{if(u.value)ze(b.value).submit();else{let p={...v.value,fields:[],validation:[]};if(t.redirect){const a=v.value.selected.map(C=>`selected[]=${C}`);let h=`${t.redirect}?class=${v.value.class}&${a.join("&")}`;window.open(h,"_blank")}else Invicta.axios.post(_.actionsUrl,p).then(({data:a})=>{Invicta.message(a.message),Invicta.emit("refresh-resource")});o.value=!1}},B=()=>{Invicta.emit("refresh-resource"),o.value=!1};return(p,a)=>{const h=Q,C=R,U=_e;return n(),r(U,{modelValue:e(o),"onUpdate:modelValue":a[1]||(a[1]=E=>me(o)?o.value=E:null),title:e(t).name,width:"30%"},{footer:l(()=>[d(C,{onClick:a[0]||(a[0]=E=>o.value=!1)},{default:l(()=>a[2]||(a[2]=[y("Cancel")])),_:1}),d(C,{type:e(w),onClick:D},{default:l(()=>[y(k(e(x)),1)]),_:1},8,["type"])]),default:l(()=>[e(u)?(n(),r(h,{key:e(b),headless:!0,"form-id":e(b),resource:e(t),"action-url":m.actionsUrl,params:e(v),"save-tabs":!1,onSubmitted:B},null,8,["form-id","resource","action-url","params"])):(n(),A("div",Ve,"Are you sure you want to run this action?"))]),_:1},8,["modelValue","title"])}}},Ne={__name:"Actions",props:{name:{type:String,default:"Actions"},global:{type:Boolean,default:!1},actions:Array,selected:{type:Array,default:[]}},setup(m){const I=m,_=o=>{console.log("have command",o);let t={action:o,selected:I.selected.length?I.selected:[]};Invicta.emit("action-called",t)};return(o,t)=>{const b=fe,f=R,u=J,v=K;return n(),r(v,{trigger:"click",onCommand:_,class:"mr-2"},{dropdown:l(()=>[(n(!0),A(j,null,H(m.actions,w=>(n(),r(u,{command:w},{default:l(()=>[y(k(w.name),1)]),_:2},1032,["command"]))),256))]),default:l(()=>[d(f,{size:"large"},{default:l(()=>[y(k(m.name)+" ",1),d(b,{class:"el-icon--right"},{default:l(()=>[d(e(pe))]),_:1})]),_:1})]),_:1})}}},Oe={class:"mx-2"},qe={__name:"LocaleSwitch",props:{locales:Object},setup(m){const I=m,{locales:_}=I,o=Invicta.getConfig("currentLocale"),t=_[o].hasOwnProperty("flag"),b=f=>{let u=new URL(window.location.href);u.searchParams.set("locale",f),window.location.href=u.toString()};return(f,u)=>{const v=Pe,w=je,x=R,D=J,B=ve,p=K;return n(),r(p,{class:"mr-4",onCommand:b},{dropdown:l(()=>[d(B,null,{default:l(()=>[(n(!0),A(j,null,H(e(_),a=>(n(),r(D,{key:a.iso,command:a.iso,disabled:e(o)==a.iso},{default:l(()=>[y(k(a.name),1)]),_:2},1032,["command","disabled"]))),128))]),_:1})]),default:l(()=>[d(x,{size:"small",text:"",type:"info"},{default:l(()=>[d(v,{icon:e(ge),width:15},null,8,["icon"]),u[0]||(u[0]=y()),i("span",Oe,k(e(_)[e(o)].name),1),e(t)?(n(),r(w,{key:0,country:e(_)[e(o)].flag},null,8,["country"])):$("",!0)]),_:1})]),_:1})}}},Ge={key:0,class:"py-6 px-10"},He={class:"flex items-end justify-start mb-4"},Je={class:"flex-auto mr-4"},Ke={class:"mb-1"},Qe={class:"max-w-sm"},We={class:"ml-auto flex items-center"},Xe={class:"el-card"},Ye={class:"flex items-center justify-start p-3"},Ze={class:"mr-2 leading-none"},et={class:"ml-auto leading-none flex items-center"},tt={key:0,class:"bg-slate-100 px-3 py-2 flex items-center justify-between"},st={class:"flex items-center leading-none"},at={class:"mr-2 text-sm"},nt={class:"ml-auto flex items-center"},ot={class:"ml-3",title:"Delete Selected"},lt={class:"flex items-center justify-between p-3 mt-2"},ct={key:1,class:"p-10 flex items-center justify-center"},it={class:"px-8 pb-4 pt-12 w-full"},vt={__name:"IndexBase",props:{handle:String},setup(m){const I=he(),_=ye(),o=m,t=Be(o.handle);t.initIndex(_);const b=g(),f=g(!1),u=g(),v=g(),w=g(""),x=g({}),D=`api${_.path}/actions`;be(()=>{Invicta.on("action-called",B)}),we(()=>{Invicta.off("action-called",B)});const B=({action:c,selected:s})=>{if(c.modal)Invicta.emit("show-action-modal",{action:c,selected:s});else{let S=null;x.value={class:c.class},s.length&&(x.value.selected=s,S=s[0]),Invicta.axios.get(`${D}/blueprint/${S}`,{params:{class:c.class}}).then(({data:z})=>{u.value=`${o.handle}.${S}.${c.class}`,v.value=z,w.value=D,f.value=!0})}},p=c=>{if(t.static.settings.indexEdit){let s=`api${_.path}/${c}`;x.value={},Invicta.axios.get(`${s}/edit`).then(({data:S})=>{u.value=`${o.handle}.${S.item.id}`,v.value=S,w.value=s,f.value=!0})}else I.push({name:"resourceEdit",params:{handle:o.handle,id:c}})},a=g(!1),h=g([]),C=c=>{a.value=!1,h.value=c.map(s=>s.id)},U=async()=>{let c=await t.selectAll();a.value=!0,h.value=c.data},E=F(()=>`${a.value?t.data.total:h.value.length} records selected`),W=()=>{a.value=!1,b.value.clearSelection(),h.value=[]},X=F(()=>!ke(t.data.activeFilters)),T=c=>{Se.confirm("This action will permanently delete records from database. Are you sure you want to continue?","Deleting",{confirmButtonText:"Delete",cancelButtonText:"Cancel",confirmButtonClass:"el-button--danger"}).then(()=>{Invicta.axios.delete(`api${_.path}`,{data:{selected:c}}).then(({data:s})=>{Invicta.message(s.message),t.getResource()})}).catch(s=>{console.log("cancel",s)})},Y=()=>{h.value.length&&T(h.value)},Z=c=>{c.action=="close"&&(f.value=!1),t.getResource()};return Invicta.on("refresh-resource",()=>{t.getResource()}),(c,s)=>{var N,O;const S=Fe,z=qe,V=Ne,M=R,ee=$e("router-link"),te=Ee,L=Ie,se=Re,ae=Ue,ne=De,oe=Le,le=Me,ce=Q,ie=Ce,re=Te,de=Ae;return n(),A(j,null,[e(t).static.settings?(n(),A("div",Ge,[i("div",He,[i("div",Je,[i("h1",Ke,k(e(t).static.settings.title),1),i("div",Qe,[(n(),r(S,{currentSearch:e(_).query.search,key:m.handle,onUpdate:e(t).setSearch},null,8,["currentSearch","onUpdate"]))])]),i("div",We,[e(t).static.settings.locales?(n(),r(z,{key:0,locales:e(t).static.settings.locales},null,8,["locales"])):$("",!0),(N=e(t).static.actions)!=null&&N.global?(n(),r(V,{key:1,global:!0,actions:e(t).static.actions.global,name:"Resource Actions"},null,8,["actions"])):$("",!0),q(c.$slots,"actions",{settings:e(t).static.settings},()=>[P(d(ee,{to:{name:"resourceCreate"}},{default:l(()=>[d(M,{type:"primary",size:"large"},{default:l(()=>s[1]||(s[1]=[y("Create new")])),_:1})]),_:1},512),[[G,e(t).static.settings.canCreate]])])])]),i("div",Xe,[i("div",Ye,[i("div",Ze,[s[2]||(s[2]=y(" Total: ")),i("strong",null,k(e(t).data.total),1)]),i("div",null,[d(te,{badges:e(t).data.filterBadges},null,8,["badges"])]),i("div",et,[e(X)?(n(),r(L,{key:0,onClick:e(t).clearFilters,underline:!1,type:"danger",class:"mr-2"},{default:l(()=>s[3]||(s[3]=[y("Clear all filters")])),_:1},8,["onClick"])):$("",!0),e(t).static.filters?(n(),r(se,{key:1,"resource-handle":m.handle,filters:e(t).static.filters,"active-filters":e(t).data.activeFilters},null,8,["resource-handle","filters","active-filters"])):$("",!0)])]),e(h).length?(n(),A("div",tt,[i("div",st,[i("span",at,k(e(E)),1),e(a)?$("",!0):(n(),r(L,{key:0,type:"primary",underline:!1,onClick:U,class:"mr-2"},{default:l(()=>[y("Select all "+k(e(t).data.total),1)]),_:1})),d(L,{underline:!1,type:"info",onClick:W},{default:l(()=>s[4]||(s[4]=[y("Deselect all")])),_:1})]),i("div",nt,[(O=e(t).static.actions)!=null&&O.bulk?(n(),r(V,{key:0,name:"Bulk Actions",actions:e(t).static.actions.bulk,selected:e(h),"selected-all":e(a)},null,8,["actions","selected","selected-all"])):$("",!0),P(i("div",ot,[d(M,{icon:e(xe),onClick:Y},null,8,["icon"])],512),[[G,e(t).static.settings.canDelete]])])])):$("",!0),q(c.$slots,"default",{resource:e(t).data.resourceData,settings:e(t).static.settings,handleEdit:p,handleSelect:C,handleDelete:T},()=>[P((n(),r(ae,{ref_key:"resourceTableRef",ref:b,key:m.handle,"resource-handle":m.handle,data:e(t).data.resourceData,"table-props":e(t).static.settings.table,columns:e(t).static.settings.columns,"can-edit":e(t).static.settings.canEdit,"can-delete":e(t).static.settings.canDelete,"has-detail":e(t).static.settings.hasDetail,onSelect:C,onEdit:p,onDelete:T},null,8,["resource-handle","data","table-props","columns","can-edit","can-delete","has-detail"])),[[de,e(t).data.loading]])]),i("div",lt,[i("div",null,[s[5]||(s[5]=y(" Total: ")),i("strong",null,k(e(t).data.total),1)]),d(ne,{background:"",size:"small",layout:"jumper, prev, pager, next, sizes","current-page":e(t).data.currentPage,"page-size":e(t).data.perPage,total:e(t).data.total,"onUpdate:pageSize":e(t).setPageSize,"onUpdate:currentPage":e(t).setPage},null,8,["current-page","page-size","total","onUpdate:pageSize","onUpdate:currentPage"])])])])):(n(),A("div",ct,[d(oe)])),d(le,{"actions-url":D}),e(f)?(n(),r(re,{key:2,onClose:s[0]||(s[0]=rt=>f.value=!1),style:{width:"80%"}},{default:l(()=>[d(ie,null,{default:l(()=>[i("div",it,[(n(),r(ce,{class:"mx-auto",key:e(u),"form-id":e(u),resource:e(v),"action-url":e(w),params:e(x),"post-submit-actions":["close","edit"],onSubmitted:Z},null,8,["form-id","resource","action-url","params"]))])]),_:1})]),_:1})):$("",!0)],64)}}};export{vt as _};
