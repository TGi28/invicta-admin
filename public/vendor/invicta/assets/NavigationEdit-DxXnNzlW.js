import{U as he,V as $e,W as X,o as m,e as V,i as d,t as z,l as i,u as t,X as Ie,g as $,h as C,w as u,j as we,F as T,y as D,k as g,L as ke,Y as xe,B as S,D as M,Z as Y,_ as Ce,$ as Ve,a0 as Ee,a1 as Se,b as Z,n as J,a2 as ze,q as K,a3 as Ne,a4 as De,G as P,a5 as Q,H as ee,M as Ae,a6 as Le,p as Te,S as Ue,a7 as Fe,a8 as Me,T as Oe,a9 as Be}from"./vendor-Ci2skXiS.js";/* empty css                */import{_ as Re,a as je,b as te,c as qe,d as He}from"./dropdown-menu-b-xYQiLk.js";/* empty css               */import{_ as Ge}from"./AssetForm-ZB7uFVuh.js";import{b as ne}from"./main-BikrXCWR.js";/* empty css             */import{d as We,_ as Xe}from"./vuedraggable.umd-Bih-jZxY.js";import"./Loading-BjVsGdfx.js";const Ye={class:"mb-4"},Ze={key:0,class:"asset-wrap"},Je=["src"],Ke={class:"asset-details mr-auto"},Pe={key:2,class:"asset-wrap"},Qe={__name:"NavItemIcon",props:he({disabled:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const f=$e(b,"modelValue"),I=b,a=X({state:!1,context:"library"}),y=l=>{f.value=l,a.state=!1},h=()=>{I.disabled||(a.context="edit",a.state=!0)},p=()=>{a.context="library",a.state=!0};return(l,e)=>{const r=ne,E=Re,w=je,v=Ge,k=te;return m(),V(T,null,[d("div",Ye,[e[4]||(e[4]=d("label",{class:"mb-3"},"Icon",-1)),f.value?(m(),V("div",Ze,[d("div",{class:"asset",onClick:h},[d("img",{src:f.value.src},null,8,Je)]),d("div",Ke,[d("strong",null,z(f.value.name),1)]),d("span",{class:"mr-3 action-icon",onClick:e[0]||(e[0]=c=>f.value=null)},[i(r,{icon:t(Ie),width:18},null,8,["icon"])])])):b.disabled?b.disabled?(m(),V("div",Pe,"No image")):C("",!0):(m(),$(E,{key:1,type:"browse",onUploadComplete:y,onOpenLibrary:p,single:!0})),e[5]||(e[5]=d("div",{class:"info info-bottom opacity-60 mt-2"},"Add an image to menu item.",-1))]),t(a).state?(m(),$(k,{key:0,onClose:e[3]||(e[3]=c=>t(a).state=!1),style:we({width:t(a).context=="library"?"80%":""})},{default:u(()=>[t(a).context=="library"?(m(),$(w,{key:0,onSelected:y,onCancel:e[1]||(e[1]=c=>t(a).state=!1)})):C("",!0),t(a).context=="edit"?(m(),$(v,{key:1,asset:l.fieldValue,onClose:e[2]||(e[2]=c=>t(a).state=!1)},null,8,["asset"])):C("",!0)]),_:1},8,["style"])):C("",!0)],64)}}},et={class:"p-4 w-full"},tt={class:"mb-4 flex items-center justify-between"},nt={key:0,class:"mb-2"},ot={class:"text-right"},lt={__name:"NavItemForm",props:{mode:String,itemData:Object},setup(b){const f=b,I=D(()=>f.mode=="create"?"Create Item":"Edit Item"),a=g(f.itemData),y=g(!1),h=g(!1),p=g("");return ke(()=>{if("id"in f.itemData){y.value=!0;let l=`/api/resource/${f.itemData.handle}/${f.itemData.id}/uri`;Invicta.fetch.get(l).then(e=>{e||(h.value=!0,p.value=`${f.itemData.type} not found`),a.value.url=e})}else y.value=!1}),(l,e)=>{const r=M,E=Y,w=Ce,v=Ve,k=Qe,c=Ee,x=Se;return m(),V("div",et,[d("header",tt,[d("h1",null,z(t(I)),1),i(r,{icon:t(xe),text:"",circle:"",bg:"",onClick:e[0]||(e[0]=_=>l.$emit("close"))},null,8,["icon"])]),t(h)?(m(),V("div",nt,[i(E,{title:t(p),type:"error",effect:"dark","show-icon":"",closable:!1},null,8,["title"])])):C("",!0),i(x,{"label-position":"top",class:"invicta-form"},{default:u(()=>[i(v,{label:"Label"},{default:u(()=>[i(w,{size:"large",modelValue:t(a).label,"onUpdate:modelValue":e[1]||(e[1]=_=>t(a).label=_)},null,8,["modelValue"]),e[8]||(e[8]=d("div",{class:"info info-bottom opacity-60"},"Navigation label.",-1))]),_:1,__:[8]}),i(v,{label:"URL"},{default:u(()=>[i(w,{size:"large",modelValue:t(a).url,"onUpdate:modelValue":e[2]||(e[2]=_=>t(a).url=_),disabled:t(y)},null,8,["modelValue","disabled"]),e[9]||(e[9]=d("div",{class:"info info-bottom opacity-60"},"Leave blank to make simple text item.",-1))]),_:1,__:[9]}),i(k,{modelValue:t(a).icon,"onUpdate:modelValue":e[3]||(e[3]=_=>t(a).icon=_),disabled:!1},null,8,["modelValue"]),i(v,{label:"CSS class"},{default:u(()=>[i(w,{size:"large",modelValue:t(a).css,"onUpdate:modelValue":e[4]||(e[4]=_=>t(a).css=_)},null,8,["modelValue"]),e[10]||(e[10]=d("div",{class:"info info-bottom opacity-60"},"Set custom CSS classes.",-1))]),_:1,__:[10]}),i(v,{label:"Description"},{default:u(()=>[i(w,{size:"large",modelValue:t(a).text,"onUpdate:modelValue":e[5]||(e[5]=_=>t(a).text=_)},null,8,["modelValue"]),e[11]||(e[11]=d("div",{class:"info info-bottom opacity-60"},"Set item description.",-1))]),_:1,__:[11]}),i(v,{label:"Open in new tab"},{default:u(()=>[i(c,{size:"large",modelValue:t(a).external,"onUpdate:modelValue":e[6]||(e[6]=_=>t(a).external=_)},null,8,["modelValue"]),e[12]||(e[12]=d("div",{class:"info info-bottom opacity-60"},"Open link in the new tab.",-1))]),_:1,__:[12]}),d("div",ot,[i(r,{type:"primary",size:"large",onClick:e[7]||(e[7]=_=>l.$emit("saved",t(a)))},{default:u(()=>e[13]||(e[13]=[S("Save Item")])),_:1,__:[13]})])]),_:1})])}}},st={class:"ml-auto item-type"},at={__name:"NavTree",props:{list:Array,childActions:Array},emits:["addChild","editItem","removeItem","change"],setup(b,{emit:f}){const I=b,a=f,y=p=>{p.action=="remove"?(I.list.splice(p.item.index,1),a("removeItem",!0)):a("addChild",p)},h=p=>{a("editItem",p)};return(p,l)=>{const e=Xe,r=ze,E=qe,w=Z("NavTree",!0);return m(),$(t(We),{list:b.list,tag:"ul",group:{name:"g1"},animation:150,"item-key":"label",onChange:l[2]||(l[2]=v=>p.$emit("change",!0))},{item:u(({element:v,index:k})=>[d("li",null,[d("div",{class:J(["item flex items-center justify-start border rounded bg-white mb-1 p-2",{error:v.error}])},[i(e,{class:"mr-2 text-gray-300 hover:text-gray-400"}),i(r,{underline:!1,onClick:c=>h(v)},{default:u(()=>[S(z(v.label),1)]),_:2},1032,["onClick"]),d("div",st,z(v.error?`${v.type} | Error`:v.type),1),i(E,{actions:b.childActions,item:{index:k,...v},title:"New Child Item",onSelected:y,class:"ml-3"},null,8,["actions","item"])],2),i(w,{list:v.children,"child-actions":b.childActions,onChange:l[0]||(l[0]=c=>p.$emit("change",!0)),onAddChild:y,onEditItem:h,onRemoveItem:l[1]||(l[1]=c=>p.$emit("removeItem",!0))},null,8,["list","child-actions"])])]),_:1},8,["list"])}}},it={class:"ml-2"},rt={__name:"NavLocalizations",props:{localizations:Object},setup(b){const f=De(),I=b,a=D(()=>{let{localizations:l}=I;return Object.values(l).filter(e=>e.origin!==null)[0].origin}),y=Object.values(I.localizations).filter(l=>l.current)[0].iso,h=l=>l.origin?"Original":l.current?"Current translation":`${l.translation?"Edit":"Create"} ${l.name} translation`,p=l=>{console.log("hadndle command",l);let e=l.translation?l.translation:l.origin?l.origin:null;e?(console.log("do I have the command",e,l),f.replace({name:"navEditItems",params:{id:e},force:!0})):Invicta.fetch.post(`/api/navigation/${a.value}/localize/${l.iso}`).then(r=>{console.log("I have created localized version of this menu",r),f.push({name:"navEditItems",params:{id:r}})})};return(l,e)=>{const r=ne,E=M,w=P,v=Q,k=ee;return m(),$(k,{class:"mr-4",onCommand:p},{dropdown:u(()=>[i(v,null,{default:u(()=>[(m(!0),V(T,null,K(b.localizations,c=>(m(),$(w,{key:c.iso,command:c,disabled:c.current,title:h(c)},{default:u(()=>[d("i",{class:J(["icon-status",{success:c.translation||c.origin}])},null,2),e[0]||(e[0]=S()),d("span",it,z(c.name),1)]),_:2,__:[0]},1032,["command","disabled","title"]))),128))]),_:1})]),default:u(()=>[i(E,{size:"small",text:"",type:"info"},{default:u(()=>[i(r,{icon:t(Ne),width:15,class:"mr-2"},null,8,["icon"]),S(" "+z(b.localizations[t(y)].name),1)]),_:1})]),_:1})}}},ut={class:"py-6 px-10"},dt={class:"w-2/3 mx-auto"},ct={class:"flex items-end justify-between mb-4"},mt={class:"mb-1"},vt={class:"nav-actions flex items-center"},pt={key:0,class:"mb-3"},kt={__name:"NavigationEdit",setup(b){const f=Oe(),I=g(!1),a=g(""),y=g("Menu"),h=g(""),p=g(null),l=g(null),e=g(null),r=X({state:!1,context:"list"});Ae(()=>f.params.id,E,{immediate:!0});function E(n){I.value=!0,Invicta.fetch.get(`api/navigation/${n}/items`).then(o=>{a.value=o.actionUrl,y.value=o.menuTitle,h.value=o.locale,p.value=o.localizations,e.value=o.tree,l.value=o.resources,I.value=!1})}const w={title:{label:"Title",sortable:!0},locale:{label:"Locale",align:"center"}},v=g(""),k=g(),c=g("link"),x=g(null),_=g(!1),O=D(()=>e.value?B(e.value):!1),oe=D(()=>_.value&&!O.value);function B(n){let o=!1;for(let s of n){if("error"in s){o=!0;break}s.children.length&&(o=B(s.children))}return o}const le=D(()=>e.value.reduce((n,o)=>(n[o.handle]=n[o.handle]||[],n[o.handle].push(o.id),n),{})),R=(n,o)=>(n.forEach(s=>{s.id==x.value.id&&s.handle==x.value.handle&&s.label==x.value.label?(console.log("debugging items",s.id,x.value.id,s.handle,x.value.handle),s.children.push(...o)):s.children.length&&(console.log("nav items have children"),R(s.children,o))}),n),j=n=>{r.state=!1;let o=n.map(s=>{var L;return{label:s[k.value],url:s==null?void 0:s.url,id:s==null?void 0:s.id,handle:c.value,type:((L=l.value[c.value])==null?void 0:L.title)||(s==null?void 0:s.type),icon:s==null?void 0:s.icon,css:s==null?void 0:s.css,text:s==null?void 0:s.text,external:s==null?void 0:s.external,children:[]}});console.log("something was selected",n,x.value),x.value?e.value=R(e.value,o):e.value=[...e.value,...o],x.value=null,c.value="custom",_.value=!0},U=Le(l.value,(n,o)=>({name:n.title,action:o}));U.push({name:"Custom Link",action:"custom",divider:!0}),U.push({name:"Remove Item",action:"remove",danger:!0});const se=n=>{n=="custom"?H():q(n),c.value=n},ae=n=>{console.log("adding child",n),x.value=n.item,c.value=n.action,n.action=="custom"?H():q(n.action)};function q(n){r.context="list",k.value=l.value[n].titleField,v.value=`/api/resource/${n}/items`,r.state=!0}const A=g("create"),F=g({}),ie={label:"",url:"",css:"",icon:"",text:"",external:!1},H=()=>{A.value="create",F.value={...ie},r.context="form",r.state=!0},re=n=>{r.state=!1,k.value="label",n.id||(console.log("check for type",n.url,n.url==""),n.type=n.url==""?"Text":"Link"),A.value=="create"&&j([n]),_.value=!0},ue=n=>{console.log("editing item",n),A.value="edit",F.value=n,r.context="form",r.state=!0},de=()=>{Invicta.fetch.post(a.value,{tree:e.value}).then(n=>{Invicta.message(n.message)})};return(n,o)=>{const s=Be,L=Z("router-link"),G=M,W=P,ce=Q,me=ee,ve=Y,pe=at,fe=He,_e=lt,ge=te,be=Ue;return m(),V(T,null,[d("div",ut,[Te((m(),V("div",dt,[d("div",ct,[d("div",null,[i(L,{to:{name:"resourceIndex",params:{handle:"navigation"}},class:"breadcrumb"},{default:u(()=>[i(s,null,{default:u(()=>[i(t(Fe))]),_:1}),o[5]||(o[5]=S("Navigation"))]),_:1,__:[5]}),d("h1",mt,z(t(y)),1)]),d("div",vt,[t(p)?(m(),$(rt,{key:0,localizations:t(p)},null,8,["localizations"])):C("",!0),i(me,{onCommand:se,class:"mr-2"},{dropdown:u(()=>[i(ce,null,{default:u(()=>[(m(!0),V(T,null,K(t(l),(N,ye)=>(m(),$(W,{command:ye},{default:u(()=>[S(z(N.title),1)]),_:2},1032,["command"]))),256)),i(W,{command:"custom"},{default:u(()=>o[7]||(o[7]=[S("Custom Link")])),_:1,__:[7]})]),_:1})]),default:u(()=>[i(G,{size:"large"},{default:u(()=>[o[6]||(o[6]=S(" New Item")),i(s,{class:"el-icon--right"},{default:u(()=>[i(t(Me))]),_:1})]),_:1,__:[6]})]),_:1}),i(G,{size:"large",type:"primary",onClick:de,disabled:!t(oe)},{default:u(()=>o[8]||(o[8]=[S("Save Changes")])),_:1,__:[8]},8,["disabled"])])]),t(O)?(m(),V("div",pt,[i(ve,{title:"This navigation has errors! Save disabled.",type:"error",effect:"dark","show-icon":"",closable:!1})])):C("",!0),(m(),$(pe,{key:t(h),list:t(e),"child-actions":t(U),onAddChild:ae,onEditItem:ue,onChange:o[0]||(o[0]=N=>_.value=!0),onRemoveItem:o[1]||(o[1]=N=>_.value=!0)},null,8,["list","child-actions"]))])),[[be,t(I)]])]),t(r).state?(m(),$(ge,{key:0,style:{width:"400px"},onClose:o[4]||(o[4]=N=>t(r).state=!1)},{default:u(()=>[t(r).context=="list"?(m(),$(fe,{key:0,select:["title","locale"],columns:w,exclude:t(le)[t(c)],"request-url":t(v),"title-field":t(k),"resource-handle":t(c),onSelected:j,onCancel:o[2]||(o[2]=N=>t(r).state=!1),where:`locale='${t(h)}'`},null,8,["exclude","request-url","title-field","resource-handle","where"])):C("",!0),t(r).context=="form"?(m(),$(_e,{key:1,mode:t(A),"item-data":t(F),onSaved:re,onClose:o[3]||(o[3]=N=>t(r).state=!1)},null,8,["mode","item-data"])):C("",!0)]),_:1})):C("",!0)],64)}}};export{kt as default};
