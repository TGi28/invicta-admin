import{T as $e,U as he,V as K,o as m,d as V,h as d,t as z,k as i,u as t,W as Ie,f as h,g as C,w as u,i as we,F as T,y as D,j as g,J as xe,X as ke,B as S,D as O,Y as W,Z as Ce,_ as Ve,$ as Ee,a0 as Se,r as X,n as Y,a1 as ze,p as Z,a2 as Ne,a3 as De,G as P,a4 as Q,H as ee,K as Ae,a5 as Le,l as Te,R as Ue,a6 as Fe,a7 as Oe,S as Me,a8 as Re}from"./vendor-DNNQIDVf.js";/* empty css                */import{_ as te}from"./Drawer-BxPEu8tM.js";/* empty css                      *//* empty css               */import{_ as Be}from"./AssetForm-6ssPU0Nz.js";import{_ as je}from"./AssetSelector-BRGsKKrN.js";import{_ as qe}from"./GridView-B7zsZOiD.js";import{a as oe}from"./main-bEgEWTd2.js";import"./functions-D7TSWOGs.js";/* empty css                  */import{_ as He}from"./ItemsSelector-B4XPSqBs.js";import{_ as Ge}from"./resource-CxGGqGWg.js";/* empty css             */import{d as Je,_ as Ke}from"./vuedraggable.umd-CEhUReVH.js";/* empty css               */import"./CheckTree-DMv88Hj1.js";/* empty css                 *//* empty css                 */import"./Filters-CoJGGan2.js";/* empty css                    */import"./vue.runtime.esm-bundler-Dq4hXjoZ.js";const We={class:"mb-4"},Xe={key:0,class:"asset-wrap"},Ye=["src"],Ze={class:"asset-details mr-auto"},Pe={key:2,class:"asset-wrap"},Qe={__name:"NavItemIcon",props:$e({disabled:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const f=he(b,"modelValue"),I=b,a=K({state:!1,context:"library"}),y=l=>{f.value=l,a.state=!1},$=()=>{I.disabled||(a.context="edit",a.state=!0)},v=()=>{a.context="library",a.state=!0};return(l,e)=>{const r=oe,E=qe,w=je,p=Be,x=te;return m(),V(T,null,[d("div",We,[e[4]||(e[4]=d("label",{class:"mb-3"},"Icon",-1)),f.value?(m(),V("div",Xe,[d("div",{class:"asset",onClick:$},[d("img",{src:f.value.src},null,8,Ye)]),d("div",Ze,[d("strong",null,z(f.value.name),1)]),d("span",{class:"mr-3 action-icon",onClick:e[0]||(e[0]=c=>f.value=null)},[i(r,{icon:t(Ie),width:18},null,8,["icon"])])])):b.disabled?b.disabled?(m(),V("div",Pe,"No image")):C("",!0):(m(),h(E,{key:1,type:"browse",onUploadComplete:y,onOpenLibrary:v,single:!0})),e[5]||(e[5]=d("div",{class:"info info-bottom opacity-60 mt-2"},"Add an image to menu item.",-1))]),t(a).state?(m(),h(x,{key:0,onClose:e[3]||(e[3]=c=>t(a).state=!1),style:we({width:t(a).context=="library"?"80%":""})},{default:u(()=>[t(a).context=="library"?(m(),h(w,{key:0,onSelected:y,onCancel:e[1]||(e[1]=c=>t(a).state=!1)})):C("",!0),t(a).context=="edit"?(m(),h(p,{key:1,asset:l.fieldValue,onClose:e[2]||(e[2]=c=>t(a).state=!1)},null,8,["asset"])):C("",!0)]),_:1},8,["style"])):C("",!0)],64)}}},et={class:"p-4 w-full"},tt={class:"mb-4 flex items-center justify-between"},ot={key:0,class:"mb-2"},nt={class:"text-right"},lt={__name:"NavItemForm",props:{mode:String,itemData:Object},setup(b){const f=b,I=D(()=>f.mode=="create"?"Create Item":"Edit Item"),a=g(f.itemData),y=g(!1),$=g(!1),v=g("");return xe(()=>{if("id"in f.itemData){y.value=!0;let l=`/api/resource/${f.itemData.handle}/${f.itemData.id}/uri`;Invicta.axios.get(l).then(({data:e})=>{e||($.value=!0,v.value=`${f.itemData.type} not found`),a.value.url=e})}else y.value=!1}),(l,e)=>{const r=O,E=W,w=Ce,p=Ve,x=Qe,c=Ee,k=Se;return m(),V("div",et,[d("header",tt,[d("h1",null,z(t(I)),1),i(r,{icon:t(ke),text:"",circle:"",bg:"",onClick:e[0]||(e[0]=_=>l.$emit("close"))},null,8,["icon"])]),t($)?(m(),V("div",ot,[i(E,{title:t(v),type:"error",effect:"dark","show-icon":"",closable:!1},null,8,["title"])])):C("",!0),i(k,{"label-position":"top",class:"invicta-form"},{default:u(()=>[i(p,{label:"Label"},{default:u(()=>[i(w,{size:"large",modelValue:t(a).label,"onUpdate:modelValue":e[1]||(e[1]=_=>t(a).label=_)},null,8,["modelValue"]),e[8]||(e[8]=d("div",{class:"info info-bottom opacity-60"},"Navigation label.",-1))]),_:1}),i(p,{label:"URL"},{default:u(()=>[i(w,{size:"large",modelValue:t(a).url,"onUpdate:modelValue":e[2]||(e[2]=_=>t(a).url=_),disabled:t(y)},null,8,["modelValue","disabled"]),e[9]||(e[9]=d("div",{class:"info info-bottom opacity-60"},"Leave blank to make simple text item.",-1))]),_:1}),i(x,{modelValue:t(a).icon,"onUpdate:modelValue":e[3]||(e[3]=_=>t(a).icon=_),disabled:!1},null,8,["modelValue"]),i(p,{label:"CSS class"},{default:u(()=>[i(w,{size:"large",modelValue:t(a).css,"onUpdate:modelValue":e[4]||(e[4]=_=>t(a).css=_)},null,8,["modelValue"]),e[10]||(e[10]=d("div",{class:"info info-bottom opacity-60"},"Set custom CSS classes.",-1))]),_:1}),i(p,{label:"Description"},{default:u(()=>[i(w,{size:"large",modelValue:t(a).text,"onUpdate:modelValue":e[5]||(e[5]=_=>t(a).text=_)},null,8,["modelValue"]),e[11]||(e[11]=d("div",{class:"info info-bottom opacity-60"},"Set item description.",-1))]),_:1}),i(p,{label:"Open in new tab"},{default:u(()=>[i(c,{size:"large",modelValue:t(a).external,"onUpdate:modelValue":e[6]||(e[6]=_=>t(a).external=_)},null,8,["modelValue"]),e[12]||(e[12]=d("div",{class:"info info-bottom opacity-60"},"Open link in the new tab.",-1))]),_:1}),d("div",nt,[i(r,{type:"primary",size:"large",onClick:e[7]||(e[7]=_=>l.$emit("saved",t(a)))},{default:u(()=>e[13]||(e[13]=[S("Save Item")])),_:1})])]),_:1})])}}},st={class:"ml-auto item-type"},at={__name:"NavTree",props:{list:Array,childActions:Array},emits:["addChild","editItem","removeItem","change"],setup(b,{emit:f}){const I=b,a=f,y=v=>{v.action=="remove"?(I.list.splice(v.item.index,1),a("removeItem",!0)):a("addChild",v)},$=v=>{a("editItem",v)};return(v,l)=>{const e=Ke,r=ze,E=Ge,w=X("NavTree",!0);return m(),h(t(Je),{list:b.list,tag:"ul",group:{name:"g1"},animation:150,"item-key":"label",onChange:l[2]||(l[2]=p=>v.$emit("change",!0))},{item:u(({element:p,index:x})=>[d("li",null,[d("div",{class:Y(["item flex items-center justify-start border rounded bg-white mb-1 p-2",{error:p.error}])},[i(e,{class:"mr-2 text-gray-300 hover:text-gray-400"}),i(r,{underline:!1,onClick:c=>$(p)},{default:u(()=>[S(z(p.label),1)]),_:2},1032,["onClick"]),d("div",st,z(p.error?`${p.type} | Error`:p.type),1),i(E,{actions:b.childActions,item:{index:x,...p},title:"New Child Item",onSelected:y,class:"ml-3"},null,8,["actions","item"])],2),i(w,{list:p.children,"child-actions":b.childActions,onChange:l[0]||(l[0]=c=>v.$emit("change",!0)),onAddChild:y,onEditItem:$,onRemoveItem:l[1]||(l[1]=c=>v.$emit("removeItem",!0))},null,8,["list","child-actions"])])]),_:1},8,["list"])}}},it={class:"ml-2"},rt={__name:"NavLocalizations",props:{localizations:Object},setup(b){const f=De(),I=b,a=D(()=>{let{localizations:l}=I;return Object.values(l).filter(e=>e.origin!==null)[0].origin}),y=Object.values(I.localizations).filter(l=>l.current)[0].iso,$=l=>l.origin?"Original":l.current?"Current translation":`${l.translation?"Edit":"Create"} ${l.name} translation`,v=l=>{console.log("hadndle command",l);let e=l.translation?l.translation:l.origin?l.origin:null;e?(console.log("do I have the command",e,l),f.replace({name:"navEditItems",params:{id:e},force:!0})):Invicta.axios.post(`/api/navigation/${a.value}/localize/${l.iso}`).then(({data:r})=>{console.log("I have created localized version of this menu",r),f.push({name:"navEditItems",params:{id:r}})})};return(l,e)=>{const r=oe,E=O,w=P,p=Q,x=ee;return m(),h(x,{class:"mr-4",onCommand:v},{dropdown:u(()=>[i(p,null,{default:u(()=>[(m(!0),V(T,null,Z(b.localizations,c=>(m(),h(w,{key:c.iso,command:c,disabled:c.current,title:$(c)},{default:u(()=>[d("i",{class:Y(["icon-status",{success:c.translation||c.origin}])},null,2),e[0]||(e[0]=S()),d("span",it,z(c.name),1)]),_:2},1032,["command","disabled","title"]))),128))]),_:1})]),default:u(()=>[i(E,{size:"small",text:"",type:"info"},{default:u(()=>[i(r,{icon:t(Ne),width:15,class:"mr-2"},null,8,["icon"]),S(" "+z(b.localizations[t(y)].name),1)]),_:1})]),_:1})}}},ut={class:"py-6 px-10"},dt={class:"w-2/3 mx-auto"},ct={class:"flex items-end justify-between mb-4"},mt={class:"mb-1"},pt={class:"nav-actions flex items-center"},vt={key:0,class:"mb-3"},Ft={__name:"NavigationEdit",setup(b){const f=Me(),I=g(!1),a=g(""),y=g("Menu"),$=g(""),v=g(null),l=g(null),e=g(null),r=K({state:!1,context:"list"});Ae(()=>f.params.id,E,{immediate:!0});function E(o){I.value=!0,Invicta.axios.get(`api/navigation/${o}/items`).then(({data:n})=>{a.value=n.actionUrl,y.value=n.menuTitle,$.value=n.locale,v.value=n.localizations,e.value=n.tree,l.value=n.resources,I.value=!1})}const w={title:{label:"Title",sortable:!0},locale:{label:"Locale",align:"center"}},p=g(""),x=g(),c=g("link"),k=g(null),_=g(!1),M=D(()=>e.value?R(e.value):!1),ne=D(()=>_.value&&!M.value);function R(o){let n=!1;for(let s of o){if("error"in s){n=!0;break}s.children.length&&(n=R(s.children))}return n}const le=D(()=>e.value.reduce((o,n)=>(o[n.handle]=o[n.handle]||[],o[n.handle].push(n.id),o),{})),B=(o,n)=>(o.forEach(s=>{s.id==k.value.id&&s.handle==k.value.handle&&s.label==k.value.label?(console.log("debugging items",s.id,k.value.id,s.handle,k.value.handle),s.children.push(...n)):s.children.length&&(console.log("nav items have children"),B(s.children,n))}),o),j=o=>{r.state=!1;let n=o.map(s=>{var L;return{label:s[x.value],url:s==null?void 0:s.url,id:s==null?void 0:s.id,handle:c.value,type:((L=l.value[c.value])==null?void 0:L.title)||(s==null?void 0:s.type),icon:s==null?void 0:s.icon,css:s==null?void 0:s.css,text:s==null?void 0:s.text,external:s==null?void 0:s.external,children:[]}});console.log("something was selected",o,k.value),k.value?e.value=B(e.value,n):e.value=[...e.value,...n],k.value=null,c.value="custom",_.value=!0},U=Le(l.value,(o,n)=>({name:o.title,action:n}));U.push({name:"Custom Link",action:"custom",divider:!0}),U.push({name:"Remove Item",action:"remove",danger:!0});const se=o=>{o=="custom"?H():q(o),c.value=o},ae=o=>{console.log("adding child",o),k.value=o.item,c.value=o.action,o.action=="custom"?H():q(o.action)};function q(o){r.context="list",x.value=l.value[o].titleField,p.value=`/api/resource/${o}/items`,r.state=!0}const A=g("create"),F=g({}),ie={label:"",url:"",css:"",icon:"",text:"",external:!1},H=()=>{A.value="create",F.value={...ie},r.context="form",r.state=!0},re=o=>{r.state=!1,x.value="label",o.id||(console.log("check for type",o.url,o.url==""),o.type=o.url==""?"Text":"Link"),A.value=="create"&&j([o]),_.value=!0},ue=o=>{console.log("editing item",o),A.value="edit",F.value=o,r.context="form",r.state=!0},de=()=>{Invicta.axios.post(a.value,{tree:e.value}).then(({data:o})=>{Invicta.message(o.message)})};return(o,n)=>{const s=Re,L=X("router-link"),G=O,J=P,ce=Q,me=ee,pe=W,ve=at,fe=He,_e=lt,ge=te,be=Ue;return m(),V(T,null,[d("div",ut,[Te((m(),V("div",dt,[d("div",ct,[d("div",null,[i(L,{to:{name:"resourceIndex",params:{handle:"navigation"}},class:"breadcrumb"},{default:u(()=>[i(s,null,{default:u(()=>[i(t(Fe))]),_:1}),n[5]||(n[5]=S("Navigation"))]),_:1}),d("h1",mt,z(t(y)),1)]),d("div",pt,[t(v)?(m(),h(rt,{key:0,localizations:t(v)},null,8,["localizations"])):C("",!0),i(me,{onCommand:se,class:"mr-2"},{dropdown:u(()=>[i(ce,null,{default:u(()=>[(m(!0),V(T,null,Z(t(l),(N,ye)=>(m(),h(J,{command:ye},{default:u(()=>[S(z(N.title),1)]),_:2},1032,["command"]))),256)),i(J,{command:"custom"},{default:u(()=>n[7]||(n[7]=[S("Custom Link")])),_:1})]),_:1})]),default:u(()=>[i(G,{size:"large"},{default:u(()=>[n[6]||(n[6]=S(" New Item")),i(s,{class:"el-icon--right"},{default:u(()=>[i(t(Oe))]),_:1})]),_:1})]),_:1}),i(G,{size:"large",type:"primary",onClick:de,disabled:!t(ne)},{default:u(()=>n[8]||(n[8]=[S("Save Changes")])),_:1},8,["disabled"])])]),t(M)?(m(),V("div",vt,[i(pe,{title:"This navigation has errors! Save disabled.",type:"error",effect:"dark","show-icon":"",closable:!1})])):C("",!0),(m(),h(ve,{key:t($),list:t(e),"child-actions":t(U),onAddChild:ae,onEditItem:ue,onChange:n[0]||(n[0]=N=>_.value=!0),onRemoveItem:n[1]||(n[1]=N=>_.value=!0)},null,8,["list","child-actions"]))])),[[be,t(I)]])]),t(r).state?(m(),h(ge,{key:0,style:{width:"400px"},onClose:n[4]||(n[4]=N=>t(r).state=!1)},{default:u(()=>[t(r).context=="list"?(m(),h(fe,{key:0,select:["title","locale"],columns:w,exclude:t(le)[t(c)],"request-url":t(p),"title-field":t(x),"resource-handle":t(c),onSelected:j,onCancel:n[2]||(n[2]=N=>t(r).state=!1),where:`locale='${t($)}'`},null,8,["exclude","request-url","title-field","resource-handle","where"])):C("",!0),t(r).context=="form"?(m(),h(_e,{key:1,mode:t(A),"item-data":t(F),onSaved:re,onClose:n[3]||(n[3]=N=>t(r).state=!1)},null,8,["mode","item-data"])):C("",!0)]),_:1})):C("",!0)],64)}}};export{Ft as default};
