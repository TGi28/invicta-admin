import{d as z,b as H}from"./dropdown-menu-CKPUlIQf.js";import{k as g,L as M,o as a,g as r,w as d,i as w,u as t,l as x,B as F,h as m,D as R,s as P,t as E,e as C,a2 as T,W as G,y as h,I as J,bp as K,bq as Q,br as X,F as Y,ah as j}from"./vendor-Ci2skXiS.js";import{u as Z,_ as ee}from"./FormBase-CL_jVsOw.js";import{b as te}from"./main-De1YSX_O.js";import{d as ne,_ as se}from"./vuedraggable.umd-CXaVvIdt.js";/* empty css             */const ie={class:"w-9/12 pt-12 mx-auto"},le={__name:"ItemsForm",props:{requestUrl:String,createWith:Object},emits:["submit"],setup(n,{emit:I}){const e=n,f=I,u=g(null),i=g(null),k=g(0),{createWith:p}=e;M(()=>{Invicta.fetch.get(e.requestUrl).then(l=>{u.value=l,i.value=l.meta.id?`${l.meta.handle}.${l.meta.id}`:`${l.meta.handle}.${k.value}.new`}),k.value++});const $=()=>{if(p){const l=Z(i.value);l.set(p.field,p.value),l.setReadOnly(p.field)}},S=l=>{console.log("we have handle submit in Items Form",l),(l.action=="back"||l.action=="close")&&f("submit")};return(l,b)=>{const D=R,_=ee,B=P;return a(),r(B,null,{default:d(()=>[w("div",ie,[t(u)?(a(),r(_,{key:t(i),"form-id":t(i),resource:t(u),"action-url":t(u).meta.actionUrl,"post-submit-actions":["close","create"],onFormReady:$,onSubmitted:S},{"form-actions":d(()=>[x(D,{class:"ml-auto mr-2",text:"",onClick:b[0]||(b[0]=q=>l.$emit("cancel"))},{default:d(()=>b[1]||(b[1]=[F("Cancel")])),_:1,__:[1]})]),_:1},8,["form-id","resource","action-url"])):m("",!0)])]),_:1})}}},oe={key:1,class:"px-2"},ae={__name:"ItemListItem",props:{item:Object,titleField:String,canEdit:Boolean},setup(n){return(I,e)=>{const f=T;return n.canEdit?(a(),r(f,{key:0,underline:!1,class:"px-2",onClick:e[0]||(e[0]=u=>I.$emit("edit",n.item.id))},{default:d(()=>[F(E(n.item[n.titleField]),1)]),_:1})):(a(),C("div",oe,E(n.item[n.titleField]),1))}}},re={class:"item flex items-center justify-start mb-2 border rounded"},ce={class:"ml-auto flex items-center"},me={key:0,class:"mr-2 text-gray-400"},de={key:1,class:"action-icon",title:"Remove Item"},ue={class:"flex mt-4"},xe={__name:"ItemsList",props:{list:{type:Array,default:[],required:!0},itemsUrl:String,fieldData:Object,resource:String,itemId:Number,sortable:Boolean,editable:{type:Boolean,default:!1},options:{type:Object,default:()=>({addItems:!1,createItems:!0})},select:{type:Array,default:[]},where:String},emits:["updated","form-submitted"],setup(n,{emit:I}){const e=n,f=I,u=`api/resource/${e.resource}`,i=G({state:!1,context:"list"}),k=h(()=>e.options.createItems&&Invicta.can(`create ${e.resource}`)),p=e.editable&&Invicta.can(`edit ${e.resource}`),$="titleField"in e.fieldData?e.fieldData.titleField:"title",S=h(()=>e.fieldData.itemComponent&&Invicta.componentExists(e.fieldData.itemComponent)?e.fieldData.itemComponent:ae),l=h(()=>e.list.map(o=>o.id));function b(o){e.list.splice(e.list.findIndex(s=>s.id==o),1),f("updated",e.list)}const D=o=>{i.state=!1;let s=j(e.list),y=j(o),v=[...s,...y];f("updated",v)},_=g(""),B=o=>{i.context="form",i.state=!0,_.value=`${u}/${o}/edit`},q=()=>{i.context="list",i.state=!0},U=h(()=>{if("createWith"in e.fieldData){let o=e.fieldData.createWith,s=typeof o=="object"?o.field:o,y=e.itemId;return typeof o=="object"&&(y="multiple"in createwith&&o.multiple?[{id:e.itemId}]:{id:e.itemId}),{field:s,value:y}}return null}),W=()=>{i.context="form",i.state=!0,_.value=`${u}/create`};return(o,s)=>{const y=se,v=te,L=R,O=z,N=le,A=H;return a(),C(Y,null,[x(t(ne),{list:n.list,disabled:!n.sortable,animation:150,handle:".drag-handle","item-key":"index",class:"items-stack w-full",onChange:s[0]||(s[0]=c=>o.$emit("updated",n.list))},{item:d(({element:c,index:V})=>[w("div",re,[n.sortable?(a(),r(y,{key:0,class:"text-gray-300 hover:text-gray-400 mr-1"})):m("",!0),(a(),r(J(t(S)),{item:c,index:V,"title-field":t($),"can-edit":t(p),onEdit:B,class:"ml-1"},null,40,["item","index","title-field","can-edit"])),w("div",ce,[c.locale?(a(),C("span",me,E(c.locale),1)):m("",!0),n.options.addItems?(a(),C("span",de,[x(v,{icon:t(K),onClick:fe=>b(c.id),width:16},null,8,["icon","onClick"])])):m("",!0)])])]),footer:d(()=>[w("div",ue,[t(k)?(a(),r(L,{key:0,type:"primary",text:"",bg:"",size:"small",onClick:W},{default:d(()=>[x(v,{icon:t(Q),width:15,class:"mr-1"},null,8,["icon"]),s[5]||(s[5]=F(" Create new "))]),_:1,__:[5]})):m("",!0),n.options.addItems?(a(),r(L,{key:1,type:"primary",text:"",bg:"",size:"small",onClick:q},{default:d(()=>[x(v,{icon:t(X),width:15,class:"mr-1"},null,8,["icon"]),s[6]||(s[6]=F(" Add existing "))]),_:1,__:[6]})):m("",!0)])]),_:1},8,["list","disabled"]),t(i).state?(a(),r(A,{key:0,onClose:s[4]||(s[4]=c=>t(i).state=!1)},{default:d(()=>[t(i).context=="list"?(a(),r(O,{key:0,exclude:t(l),"resource-handle":n.resource,"request-url":n.itemsUrl,"title-field":t($),select:n.select,where:n.where,onSelected:D,onCancel:s[1]||(s[1]=c=>t(i).state=!1)},null,8,["exclude","resource-handle","request-url","title-field","select","where"])):m("",!0),t(i).context=="form"?(a(),r(N,{key:1,"request-url":t(_),"create-with":t(U),onCancel:s[2]||(s[2]=c=>t(i).state=!1),onSubmit:s[3]||(s[3]=c=>t(i).state=!1)},null,8,["request-url","create-with"])):m("",!0)]),_:1})):m("",!0)],64)}}};export{xe as _};
