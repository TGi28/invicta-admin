import{_ as R}from"./FieldBase-DA-QK4G3.js";import{k as p,af as h,L as S,a6 as F,o as m,g as k,w as y,l as x,aq as E,u as i,ap as N,e as $,F as L,q as P,aH as U,aI as j}from"./vendor-CKoRGJ0e.js";import"./dropdown-menu-DkWoAgjh.js";import{u as q}from"./field-CUKXCLJF.js";import{u as C}from"./FormBase-DY-dloLv.js";import"./Loading-Bgf6Mezb.js";import"./main-NVFK8y-D.js";/* empty css             */const Q={__name:"relatedSelectField",props:{formId:String,data:Object,path:String},setup(u){const a=u,c=p(!1),v=q(a),s=v.value(),O=C(a.formId),d=h(a.data,"titleField","title"),w="props"in a.data?h(a.data.props,"remote",!1):!1,B=`/api/resource/${O.settings.handle}/relationship/${a.data.id}`,o=p([]),_=p([]);S(()=>{if(w)_.value=o.value=F(s.value,e=>({key:e.id,value:{id:e.id,name:e[d]},label:e[d]}));else{let e={title:d};e=b(e),g(e)}});async function V(e){if(e!==""){let t={title:d,search:e};t=b(t),await g(t,!0)}else o.value=[]}function g(e,t=!1){c.value=!0,Invicta.fetch.get(B,{params:e}).then(f=>{let n=F(f,(r,l)=>{let I="path"in a.data?Number(r):{id:Number(r)};return{key:r,value:I,label:l}});t?o.value=[..._.value,...n]:o.value=n,c.value=!1})}function b(e){return a.data.where&&(e.where=a.data.where),a.data.sortBy&&(e.sort_by=a.data.sortBy),a.data.sortOrder&&(e.sort_order=a.data.sortOrder),e}return(e,t)=>{const f=U,n=j,r=R;return m(),k(r,{"form-id":u.formId,"field-props":a,class:"related-field"},{default:y(()=>[x(n,E({modelValue:i(s),"onUpdate:modelValue":t[0]||(t[0]=l=>N(s)?s.value=l:null),valueKey:"id","remote-method":V,loading:i(c),teleported:!1,disabled:i(v).disabled},u.data.props),{default:y(()=>[(m(!0),$(L,null,P(i(o),l=>(m(),k(f,{key:l.key,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},16,["modelValue","loading","disabled"])]),_:1},8,["form-id","field-props"])}}};export{Q as default};
