import{d as z,b as H}from"./dropdown-menu-C_E2RjSt.js";import{j as h,L as M,o as a,f as r,w as d,h as w,u as t,k,B as F,g as m,D as R,s as P,t as E,d as C,a1 as T,V as G,y as g,I as J,bp as K,bq as Q,br as X,F as Y,ag as j}from"./vendor-DJE8ga0U.js";import{u as Z,_ as ee}from"./FormBase-OGw2L5uy.js";import{b as te}from"./main-B4RZwH-e.js";import{d as ne,_ as se}from"./vuedraggable.umd-Cp-FbHIJ.js";/* empty css             */const ie={class:"w-9/12 pt-12 mx-auto"},oe={__name:"ItemsForm",props:{requestUrl:String,createWith:Object},emits:["submit"],setup(n,{emit:I}){const e=n,f=I,u=h(null),i=h(null),$=h(0),{createWith:p}=e;M(()=>{Invicta.axios.get(e.requestUrl).then(({data:o})=>{u.value=o,i.value=o.meta.id?`${o.meta.handle}.${o.meta.id}`:`${o.meta.handle}.${$.value}.new`}),$.value++});const _=()=>{if(p){const o=Z(i.value);o.set(p.field,p.value),o.setReadOnly(p.field)}},S=o=>{console.log("we have handle submit in Items Form",o),(o.action=="back"||o.action=="close")&&f("submit")};return(o,b)=>{const D=R,v=ee,B=P;return a(),r(B,null,{default:d(()=>[w("div",ie,[t(u)?(a(),r(v,{key:t(i),"form-id":t(i),resource:t(u),"action-url":t(u).meta.actionUrl,"post-submit-actions":["close","create"],onFormReady:_,onSubmitted:S},{"form-actions":d(()=>[k(D,{class:"ml-auto mr-2",text:"",onClick:b[0]||(b[0]=q=>o.$emit("cancel"))},{default:d(()=>b[1]||(b[1]=[F("Cancel")])),_:1})]),_:1},8,["form-id","resource","action-url"])):m("",!0)])]),_:1})}}},le={key:1,class:"px-2"},ae={__name:"ItemListItem",props:{item:Object,titleField:String,canEdit:Boolean},setup(n){return(I,e)=>{const f=T;return n.canEdit?(a(),r(f,{key:0,underline:!1,class:"px-2",onClick:e[0]||(e[0]=u=>I.$emit("edit",n.item.id))},{default:d(()=>[F(E(n.item[n.titleField]),1)]),_:1})):(a(),C("div",le,E(n.item[n.titleField]),1))}}},re={class:"item flex items-center justify-start mb-2 border rounded"},ce={class:"ml-auto flex items-center"},me={key:0,class:"mr-2 text-gray-400"},de={key:1,class:"action-icon",title:"Remove Item"},ue={class:"flex mt-4"},ke={__name:"ItemsList",props:{list:{type:Array,default:[],required:!0},itemsUrl:String,fieldData:Object,resource:String,itemId:Number,sortable:Boolean,editable:{type:Boolean,default:!1},options:{type:Object,default:()=>({addItems:!1,createItems:!0})},select:{type:Array,default:[]},where:String},emits:["updated","form-submitted"],setup(n,{emit:I}){const e=n,f=I,u=`api/resource/${e.resource}`,i=G({state:!1,context:"list"}),$=g(()=>e.options.createItems&&Invicta.can(`create ${e.resource}`)),p=e.editable&&Invicta.can(`edit ${e.resource}`),_="titleField"in e.fieldData?e.fieldData.titleField:"title",S=g(()=>e.fieldData.itemComponent&&Invicta.componentExists(e.fieldData.itemComponent)?e.fieldData.itemComponent:ae),o=g(()=>e.list.map(l=>l.id));function b(l){e.list.splice(e.list.findIndex(s=>s.id==l),1),f("updated",e.list)}const D=l=>{i.state=!1;let s=j(e.list),y=j(l),x=[...s,...y];f("updated",x)},v=h(""),B=l=>{i.context="form",i.state=!0,v.value=`${u}/${l}/edit`},q=()=>{i.context="list",i.state=!0},U=g(()=>{if("createWith"in e.fieldData){let l=e.fieldData.createWith,s=typeof l=="object"?l.field:l,y=e.itemId;return typeof l=="object"&&(y="multiple"in createwith&&l.multiple?[{id:e.itemId}]:{id:e.itemId}),{field:s,value:y}}return null}),O=()=>{i.context="form",i.state=!0,v.value=`${u}/create`};return(l,s)=>{const y=se,x=te,L=R,W=z,N=oe,V=H;return a(),C(Y,null,[k(t(ne),{list:n.list,disabled:!n.sortable,animation:150,handle:".drag-handle","item-key":"index",class:"items-stack w-full",onChange:s[0]||(s[0]=c=>l.$emit("updated",n.list))},{item:d(({element:c,index:A})=>[w("div",re,[n.sortable?(a(),r(y,{key:0,class:"text-gray-300 hover:text-gray-400 mr-1"})):m("",!0),(a(),r(J(t(S)),{item:c,index:A,"title-field":t(_),"can-edit":t(p),onEdit:B,class:"ml-1"},null,40,["item","index","title-field","can-edit"])),w("div",ce,[c.locale?(a(),C("span",me,E(c.locale),1)):m("",!0),n.options.addItems?(a(),C("span",de,[k(x,{icon:t(K),onClick:fe=>b(c.id),width:16},null,8,["icon","onClick"])])):m("",!0)])])]),footer:d(()=>[w("div",ue,[t($)?(a(),r(L,{key:0,type:"primary",text:"",bg:"",size:"small",onClick:O},{default:d(()=>[k(x,{icon:t(Q),width:15,class:"mr-1"},null,8,["icon"]),s[5]||(s[5]=F(" Create new "))]),_:1})):m("",!0),n.options.addItems?(a(),r(L,{key:1,type:"primary",text:"",bg:"",size:"small",onClick:q},{default:d(()=>[k(x,{icon:t(X),width:15,class:"mr-1"},null,8,["icon"]),s[6]||(s[6]=F(" Add existing "))]),_:1})):m("",!0)])]),_:1},8,["list","disabled"]),t(i).state?(a(),r(V,{key:0,onClose:s[4]||(s[4]=c=>t(i).state=!1)},{default:d(()=>[t(i).context=="list"?(a(),r(W,{key:0,exclude:t(o),"resource-handle":n.resource,"request-url":n.itemsUrl,"title-field":t(_),select:n.select,where:n.where,onSelected:D,onCancel:s[1]||(s[1]=c=>t(i).state=!1)},null,8,["exclude","resource-handle","request-url","title-field","select","where"])):m("",!0),t(i).context=="form"?(a(),r(N,{key:1,"request-url":t(v),"create-with":t(U),onCancel:s[2]||(s[2]=c=>t(i).state=!1),onSubmit:s[3]||(s[3]=c=>t(i).state=!1)},null,8,["request-url","create-with"])):m("",!0)]),_:1})):m("",!0)],64)}}};export{ke as _};
