import{_}from"./FieldBase-CJqAS9Xu.js";import{_ as I}from"./ItemsList-TRkY9Usf.js";import{u as $}from"./FormBase-DYw9ghXD.js";import{y as m,o as b,f as w,w as k,k as v,u as n}from"./vendor-DNNQIDVf.js";/* empty css                  */import"./field-B4hST7Z8.js";import"./Drawer-BxPEu8tM.js";import"./ItemsSelector-B4XPSqBs.js";import"./resource-CxGGqGWg.js";/* empty css                 */import"./main-bEgEWTd2.js";import"./CheckTree-DMv88Hj1.js";/* empty css               */import"./functions-D7TSWOGs.js";import"./Filters-CoJGGan2.js";/* empty css                    */import"./vuedraggable.umd-CEhUReVH.js";import"./vue.runtime.esm-bundler-Dq4hXjoZ.js";/* empty css             *//* empty css                      *//* empty css             */import"./dynamic-import-helper-BheWnx7M.js";const M={__name:"relatedListField",props:{formId:String,data:Object,path:String},setup(s){const e=s,t=$(e.formId),c=`/api/resource/${t.settings.handle}/relationship/${e.data.id}`,r=e.path.split(".").pop(),d=e.path!==r,f=Invicta.can(`edit ${r}`),l=m(()=>t.get(e.path,!1)),u=m(()=>{let o=t.get(r,[]);return d&&l.value.length?l.value.map(i=>o.find(a=>a.id===i)):o});Invicta.on("resource-form-submitted",h);function p(o){if(d){let i=o.map(a=>a.id);t.set(e.path,i)}t.set(r,o)}function h(){if(console.log("we need to make a call here - where?",t.settings,e.data.id),!t.settings.id)return!1;let o=`/api/resource/${t.settings.handle}/${t.settings.id}/relationship/${e.data.id}`;Invicta.axios.get(o).then(({data:i})=>{console.log("I got this new data here",i),p(i)})}return(o,i)=>{const a=I,g=_;return b(),w(g,{"form-id":s.formId,"field-props":e,class:"related-field"},{default:k(()=>[v(a,{list:n(u),sortable:d,editable:n(f),"items-url":c,"field-data":s.data,resource:n(r),"item-id":n(t).settings.id,options:s.data.options,onUpdated:p},null,8,["list","editable","field-data","resource","item-id","options"])]),_:1},8,["form-id","field-props"])}}};export{M as default};
